---
title: 'ESC530 Analysing Spatial Data: Project Report'
author: "Sebastian Luckeneder"
date: "8th January 2021"
output:
  pdf_document: default
  html_document: default
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width=12, fig.height=8)
```

# Mining and regional GDP growth - the Brazilian case 

## Research interest (beyond this course project)

It is well-known that mining activities relate to hazardous environmental and social consequences. And yet, mining is often related to 'development' as a constitutional starting point of a series of economic and social changes. This proposed study restricts the understanding of 'development' to to the simple, but measurable, construct of GDP growth, asking whether mining activities relate to the local GDP of mining municipalities and their surroundings. 

The effects of mining on the economy have been widely debated, and theoretical channels have been discussed, from which we can draw ambiguous conclusions. On the one hand, there is the concept of 'mining clusters', which is centred on the idea that linkages between multinational corporations and local firms, local employment creation and knowledge spillovers are drivers of regional development [@arias2014]. On the other hand, the emergence of 'enclave economies' seems just as reasonable, because rather than being related to the creation of local employment, the large-scale natural resource development in the mining sector is highly capital-intensive. It requires significant funds for exploration, energy infrastructure, machinery, transportation networks and construction [@emel2008risky]. Also, mining increasingly becomes technologically intensive [@humphreys2007introduction]. Therefore, it is likely that employment for low-skilled workers is only short-term during the construction phase, while mining in the long-run offers fewer positions, which are taken by high-skilled (and potentially foreign) employees [@arias2014]. Furthermore, capital-intensive resources are associated with a higher likelihood of civil conflict than labour-intensive resources (such as biomass) [@van2011natural], which might hinder economic growth. 

My study will concentrate on mining expansion in Brazil. The country's president, Jair Bolsonaro, is currently on the verge of opening peripheral indigenous and protected land for mining [@siqueira2020proposed]. He constructs an old fashioned development narrative, which accepts the destruction of ecosystems, most importantly the Brazilian Amazon, and the extinction of indigenous populations, in the name of development [@hope2019brazilian]. While it is evident that the policy path taken here will threaten people and unique ecosystems  [@siqueira2020proposed; @rorato2020brazilian], there is no clear empirical evidence if these extractive activities will foster local economic growth. Such a link is, however, crucial to the president's logic of a supposedly existing trade-off, stating that environmental degradation and the destruction of indigenous livelihoods were simply the costs of such a development, from which also local communities would benefit [@branford2019brazil]. My research question is therefore, whether mining activities in Brazil can be related to the growth of local, i.e. municipality-level, GDP.

Brazil's mining sector can be divided into two parts, with projects differing in size and nature, but also regarding their locations. On the one hand, some of the world's largest mining projects, owned by major corporations and operated by national and international mining companies, are located in the state of Minas Gerais. Minas Gerais (engl. *General Mines*) has been the centre of Brazilian mining since the colonial era, and today's operations are highly capitalised and institutionalised in that region. On the other hand, large volumes of mined (precious) metals and minerals must be attributed to artisanal and small-scale mining (ASM). In the north of the country and thus widely intersecting with the Brazilian Amazon, ASM and large-scale mining co-exist, and the circumstances under which they are conducted differ from Minas Gerais. Here, mining operations very obviously affect especially vulnerable ecosystems, and many mineral deposits are located within indigenous lands. Current debates mostly concern the latter type of mining, and core questions are whether to open up indigenous and protected land for mining and how - if at all - to involve indigenous communities in metals and minerals development in the Amazon. Ambiguity among and within indigenous communities how to deal with the extraction of natural resources, ranging from complete rejection to already established informal mining businesses (and hence an open attitude towards a capitalist marked economy), contributes as another complicating factor to this topic.

I want to empirically investigate the claim that mining would positively affect both mining regions and, via spillover effects, their neighbours in terms of economic growth. For that, I intend employing a spatial econometric growth model as motivated by @lesage2008growth. Such an empirical framework will enable relating detailed mine-specific data on extraction intensity to regional economic impacts. It will take spatial autocorrelation into consideration and will allow the estimation of spillover effects between municipalities. As a first step, the research will focus on the period 2002-2011, because it marks ten years of extensive growth based on the export of primary commodities. What followed since 2011 was moderate growth of a highly resource dependent economy until, eventually, an economic crisis hit the country in 2014. A major cause of the recession was a slump in global demand and thus a decline in commodity prices. 

## Exploring the data

As a first exercise and in order to get a clearer picture about the available data, I assess how mining operations, GDP growth rates, and potentially important explanatory variables are distributed across Brazil.

As the basis for all maps, I access shapefiles from the Brazilian Institute of Geography and Statistics [@ibge2020] for national borders, states, and municipalities. I utilise the `geobr` package, select the year 2001 (because there are no maps available for 2002) and transform the coordinate reference system to WGS84:

```{r packages, echo = FALSE, eval = TRUE, message=FALSE,  warning=FALSE}
library(dplyr)
library(tidyr)
library(sf)
library(stringr)
```

```{r geobr, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
library(geobr)
print(geobr::list_geobr(), n = 5)

yr <- 2001

if(!file.exists(paste0("ibge_data/geobr/base_nat_", yr, ".shp"))){
  base_nat <- geobr::read_country(year = yr, simplified = FALSE) 
  sf::st_write(base_nat, paste0("ibge_data/geobr/base_nat_", yr, ".shp"))
} else {
  base_nat <- sf::read_sf("ibge_data/geobr/base_nat_2001.shp")
}

if(!file.exists(paste0("ibge_data/geobr/base_sta_", yr, ".shp"))){
  base_sta <- geobr::read_state(year = yr, simplified = FALSE)
  sf::st_write(base_sta, paste0("ibge_data/geobr/base_sta_", yr, ".shp"))
} else {
  base_sta <- sf::read_sf("ibge_data/geobr/base_sta_2001.shp")
}

if(!file.exists(paste0("ibge_data/geobr/base_mun_", yr, ".shp"))){
  base_mun <- geobr::read_municipality(code_muni = "all", year = yr, simplified = FALSE) 
  sf::st_write(base_mun, paste0("ibge_data/geobr/base_mun_", yr, ".shp"))
} else {
  base_mun <- sf::read_sf("ibge_data/geobr/base_mun_2001.shp")
}

base_nat <- base_nat %>% 
  sf::st_transform(crs = sf::st_crs("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"))
base_sta <- base_sta %>% 
  sf::st_transform(crs = sf::st_crs("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"))
base_mun <- base_mun %>% 
  dplyr::mutate(code_mn = as.character(code_mn)) %>%
  sf::st_transform(crs = sf::st_crs("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"))

```

### Mine locations

The exact locations of mining sites were obtained from S&P's SNL Metals and Mining Database [@snl2020]. This database is not freely available and there are clear copyright restrictions by SNL, conflicting the idea of a reproducable report. Therefore, I pre-calculated the number of active mines within each municipality (using `sf::st_join(., join = "st_intersects")` for merging the point data of mine locations with the municipality polygons and then grouping and summarising by municipality ID) and directly access this ready-to-use data:

```{r mines, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
bra_mines <- sf::read_sf("mine_data/bra_mines.shp")
```

I can now draw a map of Brazil indicating the number of active mines within each municipality. Note that I utilise the `tmap` package, which was introduced during the course and turned out especially intuitive and user-friendly to me:

```{r pmines, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
library(tmap)

bra_mines <- bra_mines %>%
  dplyr::mutate(mine_count = ifelse(mine_count == 0, NA, mine_count))

regs <- c("MG", "AC", "AM", "RO", "RR", "AP", "PA", "TO", "MT")

tmap::tm_shape(bra_mines) + 
  tmap::tm_borders(lwd=0.3, alpha=0.4) +
  tmap::tm_fill(col = "mine_count", style = "pretty", as.count = TRUE, 
                colorNA = "white", textNA = "0",
                palette = "-viridis",
                title = "No. of active mines (n = 299)", legend.reverse = TRUE) +
tmap::tm_shape(base_sta %>% dplyr::filter(abbrv_s %in% regs)) + tmap::tm_borders(lwd=1) +
tmap::tm_shape(base_nat) + tmap::tm_borders(lwd=2) +
tmap::tm_layout(legend.position = c("left", "bottom"))
```

As mentioned above, the state of Minas Gerais somewhat marks the centre of the Brazilian mining industry, while significant mining activities are also conducted in the North Region such as in Amapá and Pará. On the map, I therefore added the borders of Minas Gerais (in the south-east) as well as all states of the North Region and, as an Amazon frontier state, Mato Grosso (which is counted to the Central-West Region). The SNL data in total includes 299 active mines, with approximately one third being located in Minas Gerais, one third in the North Region and Mato Grosso, and the last third being spread across the remaining states.

Next (and not yet directly related to the econometric framework proposed later), I want to explore whether the northern states and Minas Gerais differ with respect to mining municipalities overlapping with or being proximate to protected areas, with a specific focus on indigenous land. I therefore zoom into both areas and add a layer on protected areas taken from the World Database on Protected Areas [@unep2020protected]. Note that I merge all protected lands for the two types 'indigenous' and 'other' using `sf::st_union()` (taking some time to calculate!), because many polygons overlap in the raw data. This step also reduces the size of the shapefile.

```{r pa, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
wdpa_bra <- sf::read_sf("wdpa_data/wdpa_bra.shp")

regs <- c("MG") # Minas Gerais
regs_wdpa <- stringr::str_subset(unique(wdpa_bra$SUB_LOC), paste(regs, collapse = "|"))

if (! file.exists("wdpa_data/wdpa_bra_clean_MG_indig.shp")){
  wdpa_bra_clean_MG_indig <- wdpa_bra %>% 
    dplyr::filter(SUB_LOC %in% regs_wdpa & TYPE == "Indigenous") %>% sf::st_union()
  wdpa_bra_clean_MG_other <- wdpa_bra %>% 
    dplyr::filter(SUB_LOC %in% regs_wdpa & TYPE == "other") %>% sf::st_union()
  sf::st_write(wdpa_bra_clean_MG_indig, dsn = "wdpa_data/wdpa_bra_clean_MG_indig.shp")
  sf::st_write(wdpa_bra_clean_MG_other, dsn = "wdpa_data/wdpa_bra_clean_MG_other.shp")
} else {
  wdpa_bra_clean_MG_indig <- sf::read_sf("wdpa_data/wdpa_bra_clean_MG_indig.shp")
  wdpa_bra_clean_MG_other <- sf::read_sf("wdpa_data/wdpa_bra_clean_MG_other.shp")
}

wdpa_bra_clean_MG <- rbind(
  wdpa_bra_clean_MG_indig %>% dplyr::mutate("TYPE" = "Indigenous"),
  wdpa_bra_clean_MG_other %>% dplyr::mutate("TYPE" = "Other"))
```

```{r pminesmg, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}


tmap::tm_shape(bra_mines %>% dplyr::filter(abbrv_s %in% regs)) + 
  tmap::tm_borders(lwd=0.5, alpha=0.4) +
  tmap::tm_fill(col = "mine_count", n = 4, style = "pretty", as.count = TRUE, 
                colorNA = "white", textNA = "0",
                palette = "-viridis",
                title = "No. of active mines (n = 96)", legend.reverse = TRUE) +
tmap::tm_shape(wdpa_bra_clean_MG) +
  tmap::tm_fill(col = "TYPE", palette = c("red", "darkgrey"), alpha=0.3, 
                title = "Protected area") +
tmap::tm_shape(base_sta %>% dplyr::filter(abbrv_s %in% regs)) + tmap::tm_borders(lwd=2) +
tmap::tm_layout(main.title = "Minas Gerais", legend.position = c("left", "top")) + 
tmap::tm_scale_bar(position=c("right", "bottom"))
```

```{r panorth, echo = FALSE, eval = TRUE, message=FALSE,  warning=FALSE}
regs <- c("AC", "AM", "RO", "RR", "AP", "PA", "TO", "MT") # North Region + Mato Grosso
regs_wdpa <- str_subset(unique(wdpa_bra$SUB_LOC), paste(regs, collapse = "|"))

if (! file.exists("wdpa_data/wdpa_bra_clean_north_indig.shp")){
  wdpa_bra_clean_north_indig <- wdpa_bra %>% 
    dplyr::filter(SUB_LOC %in% regs_wdpa & TYPE == "Indigenous") %>% sf::st_union()
  wdpa_bra_clean_north_other <- wdpa_bra %>% 
    dplyr::filter(SUB_LOC %in% regs_wdpa & TYPE == "other") %>% sf::st_union()
  sf::st_write(wdpa_bra_clean_north_indig, dsn = "wdpa_data/wdpa_bra_clean_north_indig.shp")
  sf::st_write(wdpa_bra_clean_north_other, dsn = "wdpa_data/wdpa_bra_clean_north_other.shp")
} else {
  wdpa_bra_clean_north_indig <- sf::read_sf("wdpa_data/wdpa_bra_clean_north_indig.shp")
  wdpa_bra_clean_north_other <- sf::read_sf("wdpa_data/wdpa_bra_clean_north_other.shp")
}
```

```{r pminesnorth, echo = FALSE, eval = TRUE, message=FALSE,  warning=FALSE}
wdpa_bra_clean_north <- rbind(
  wdpa_bra_clean_north_indig %>% dplyr::mutate("TYPE" = "Indigenous"),
  wdpa_bra_clean_north_other %>% dplyr::mutate("TYPE" = "Other"))

tmap::tm_shape(bra_mines %>% dplyr::filter(abbrv_s %in% regs)) + 
  tmap::tm_borders(lwd=0.5, alpha=0.4) +
  tmap::tm_fill(col = "mine_count", n = 4, style = "pretty", as.count = TRUE, 
                colorNA = "white", textNA = "0", palette = "-viridis",
                title = "No. of active \nmines (n = 103)", legend.reverse = TRUE) +
tmap::tm_shape(wdpa_bra_clean_north) +
  tmap::tm_fill(col = "TYPE", palette = c("red", "darkgrey"), alpha=0.3, title = "Protected area") +
tmap::tm_shape(base_sta %>% dplyr::filter(abbrv_s %in% regs)) + tmap::tm_borders(lwd=2) +
tmap::tm_layout(main.title = "North Region and Mato Grosso", 
                legend.position = c("left", "bottom"), legend.stack = "horizontal") + 
tmap::tm_scale_bar(position=c("right", "bottom"))
```

The first map indicates that there appears to be one cluster of municipalities with high mine density in Minas Gerais. While none of the mining municipalities visibly intersects with indigenous areas (which are few and small in size), there are a few cases where 'other' protected areas (such as natural reserves) partly overlap with mining municipalities. The second map gives a completely different picture for the North Region and Mato Grosso. Here, we see that vast lands are declared protected, with a substantial part due to being indigenous territories. Most of the mining activities covered in the SNL data (note that especially informal mining activities may not be listed) are located in the south of Pará and protected areas widely overlap with mining municipalities. 

### Municipality statistics

Socio-economic data at the municipality-level can be accessed from the Brazilian Institute of Geography and Statistics [@ibge2020]. Since I am interested in the 2002-2011 growth period, I will need to utilise 2002 and 2011 data and calculate the growth rates for this period. Due to a number of changes of political borders and entities in the past, I have to drop observations affected by a change of borders during the time period covered. (In fact, this can be improved, but it would require more data wrangling than feasible within the scope of the project.) 

#### GDP and growth rates:

For Brazil, the new millenium started with exceptionally high economic growth rates. Its per capita GDP advanced from 2.800 (current) USD in 2002 to 13.200 USD in 2011 [@wb2021gdp]. This is an increase of 370% and corresponds to an average annual growth rate of almost 17%! The BRL has been a stable currency since its last crises in the 1990s, but with comparably high inflation rates (compared to the EUR or USD) of about 7-10% during the period of interest. Hence there was also substantial real GDP growth. This transition was part of a development strategy that was largely fueled by the export of primary commodities (biomass as well as metals and minerals) during a period of growing demand and high commodity prices. One feedback on presenting the project proposal in-class was to think of alternative 'development' indicators, such as the Human Development Index (HDI). Unfortunately, the HDI was not available for Brazil at such granular level. In the following, I want to illustrate this period of economic growth at the level of municipalities. I access and tidy @ibge2020 data and map 2002 per capita GDP (current BRL) and 2002-2011 growth rates:

```{r gdpdat, echo = FALSE, eval = TRUE, message=FALSE,  warning=FALSE}
dat_ibge_1 <- readxl::read_excel("ibge_data/gdp_munip_1999-2012.xlsx")
colnames(dat_ibge_1) <- c("ano", "codigo_uf", "nome_uf",
"cod_municipio", "nome_munic", "nome_metro",
"codigo_meso", "nome_meso", "codigo_micro", "nome_micro",
"vab_agropecuaria", "vab_industria", 
"vab_servicos_exclusivo", "vab_adm_publica", 
"impostos", "pib_total",
"pop_last", "pib_per_capita_last")
dat_ibge_1 <- dat_ibge_1 %>%
  dplyr::filter(ano < 2010) %>%
  dplyr::mutate(cod_municipio = as.character(cod_municipio),
                ano = as.numeric(ano)) 
dat_ibge_pop <- read.csv("ibge_data/pop_municip_2002_2011.csv")
dat_ibge_1 <- dat_ibge_1 %>% dplyr::mutate(unid = paste0(ano, cod_municipio)) %>%
  dplyr::left_join(dat_ibge_pop %>% dplyr::mutate(unid = paste0(ano, cod_municipio)) %>% dplyr::select(unid, pop), by = "unid") %>%
  dplyr::mutate(pib_per_capita = pib_total * 1000 / pop)

dat_ibge_2 <- readxl::read_excel("ibge_data/gdp_munip_2010-2017.xls")
colnames(dat_ibge_2) <- c("ano", "codigo_regiao", "nome_regiao",
"codigo_uf", "sigla_uf", "nome_uf",
"cod_municipio", "nome_munic", "nome_metro",
"codigo_meso", "nome_meso", "codigo_micro", "nome_micro",
"codigo_reg_geo_imediata", "nome_reg_geo_imediata", "mun_reg_geo_imediata",
"codigo_reg_geo_intermediaria", "nome_reg_geo_intermediaria", "mun_reg_geo_intermediaria",
"codigo_concentracao_urbana", "nome_concentracao_urbana", "tipo_concentracao_urbana",
"codigo_arranjo_populacional", "nome_arranjo_populacional",
"hierarquia_urbana", "hierarquia_urbana_principais",
"codigo_regiao_rural", "nome_regiao_rural", "regiao_rural_classificacao",
"amazonia_legal", "semiarido", "cidade_de_sao_paulo",
"vab_agropecuaria", "vab_industria", "vab_servicos_exclusivo", "vab_adm_publica", "vab_total",
"impostos", "pib_total",
"pib_per_capita",
"atividade_vab1", "atividade_vab2", "atividade_vab3")
dat_ibge_2 <- dat_ibge_2 %>%
  dplyr::mutate(cod_municipio = as.character(cod_municipio),
                codigo_meso = as.character(codigo_meso),
                codigo_micro = as.character(codigo_micro)) %>%
  dplyr::mutate(pop =  pib_total * 1000 / pib_per_capita)

dat_ibge <- dplyr::bind_rows(dat_ibge_1, dat_ibge_2)
```

```{r gdpmap, echo = FALSE, eval = TRUE, message=FALSE,  warning=FALSE}
dat_gdp <- dat_ibge %>% dplyr::filter(ano == 2002) %>% 
  dplyr::mutate(pib_total = pib_total / 1000)

dat_gdp <- base_mun %>% dplyr::left_join(dat_gdp, by = c("code_mn" = "cod_municipio"))

# dat_growth <- dat_ibge %>% dplyr::filter(ano %in% c(2002, 2011)) %>% 
#   dplyr::select(cod_municipio, ano, pib_total) %>%
#   tidyr::spread(key = "ano", value = "pib_total") %>%
#   dplyr::mutate(g = (`2011` - `2002`) / `2002` * 100) %>%
#   dplyr::select(cod_municipio, g)
dat_growth <- dat_ibge %>% dplyr::filter(ano %in% c(2002, 2011)) %>% 
  dplyr::select(cod_municipio, ano, pib_per_capita) %>%
  tidyr::spread(key = "ano", value = "pib_per_capita") %>%
  dplyr::mutate(g_cap = (`2011` - `2002`) / `2002` * 100) %>%
  dplyr::select(cod_municipio, g_cap)

dat_gdp <- dat_gdp %>% 
  dplyr::left_join(dat_growth, by = c("code_mn" = "cod_municipio"))

tmap::tm_shape(dat_gdp) + 
  tmap::tm_facets(nrow = 1) + 
  tmap::tm_fill(col = c("pib_total", "g_cap"), n=8, style="quantile", palette = "-magma", title = "") +
  tmap::tm_layout(legend.position = c("left", "bottom"),
                  panel.labels=c("2002 per capita GDP (current BRL)", "2002-2011 growth rate (%)"))
```

The left map indicates 2002 per capita GDP, with municipalities being grouped into eight equally sized quantiles. We see that there were substantial differences in income across Brazilian municipalities. Many of the poorest communities are located in the Northeast Region, most notably the state of Piauí, while municipalities along the eastern coastline, in the São Paulo and Rio de Janeiro states and in the very south tend to be richest. Note that there appear to be extreme outliers at the top of the municipal income distribution. Also, important for contextualisation and against the backdrop of rather high inflation rates, note that the extremely low numbers for the bottom municipalities correspond to *current* BRL levels.

The map on the right indicates 2002-2011 per capita GDP growth rates at the municipality level, again grouping the municipalities in eight quantiles. Here, besides a cluster of high growth in the north-east, a spatial pattern is less clearly visible. Interestingly, recalling the national per capita GDP growth of 370% means that seven quantiles show growth rates below this national average. Similar to the left panel, the top quantile again includes extreme outliers. Moreover, only the bottom quantile contains municipalities with decreasing GDP.

#### Population and growth rates:

Population dynamics are frequently linked to economic growth. In fact, population growth has an essential part in economic growth theory. Therefore, I accessed municipal population data from @ibge2020. Here, I map 2002 population per municipality, and 2002-2011 population growth:

```{r popmap, echo = FALSE, eval = TRUE, message=FALSE,  warning=FALSE}
dat_pop <- dat_ibge %>% dplyr::filter(ano == 2002)
dat_pop <- base_mun %>% dplyr::left_join(dat_pop, by = c("code_mn" = "cod_municipio"))

dat_popgrowth <- dat_ibge %>% dplyr::filter(ano %in% c(2002, 2011)) %>% 
  dplyr::select(cod_municipio, ano, pop) %>%
  tidyr::spread(key = "ano", value = "pop") %>%
  dplyr::mutate(g_pop = (`2011` - `2002`) / `2002` * 100) %>%
  dplyr::select(cod_municipio, g_pop)

dat_pop <- dat_pop %>% 
  dplyr::left_join(dat_popgrowth, by = c("code_mn" = "cod_municipio"))

tmap::tm_shape(dat_pop) + 
  tmap::tm_facets(nrow = 1) + 
  tmap::tm_fill(col = c("pop", "g_pop"), n=8, style="quantile", title = "") +
  tmap::tm_layout(legend.position = c("left", "bottom"),
                  panel.labels=c("2002 population", "2002-2011 population growth"))
```

#### Sectoral structure:

Another important determinant of economic development and hence frequently part of growth models is the industry mix, usually considered in terms of proxy variables such as the gross value added (GVA) or the employment in distinct economic sectors. @ibge2020 reports the GVA in 4 economic sectors: agriculture, industry, services, and the public sector, from which I calculated the respective share of the total GVA:

```{r sectormap, echo = FALSE, eval = TRUE, message=FALSE,  warning=FALSE}
dat_sect <- dat_ibge %>% dplyr::filter(ano == 2002) %>% 
  dplyr::mutate(cod_municipio = as.character(cod_municipio)) %>% 
  dplyr::mutate(vab_agropecuaria = ifelse(vab_agropecuaria < 0, 0, vab_agropecuaria)) %>%
  dplyr::mutate(vab_total = vab_agropecuaria + vab_industria + vab_servicos_exclusivo + vab_adm_publica) %>%
  dplyr::mutate(vab_agropecuaria_perc = vab_agropecuaria / vab_total,
                vab_industria_perc = vab_industria / vab_total,
                vab_servicos_exclusivo_perc = vab_servicos_exclusivo / vab_total,
                vab_adm_publica_perc = vab_adm_publica / vab_total)

dat_sect <- base_mun %>% dplyr::left_join(dat_sect, by = c("code_mn" = "cod_municipio"))

tmap::tm_shape(dat_sect) + 
  tmap::tm_facets(nrow = 2) + 
  tmap::tm_fill(col = c("vab_agropecuaria_perc", "vab_industria_perc", "vab_servicos_exclusivo_perc", "vab_adm_publica_perc"), 
                n=8, style="quantile", title = "", palette = "-magma") +
  tmap::tm_layout(legend.position = c("left", "bottom"),
                  panel.labels=c("2002 GVA acgriculture (%)", "2002 GVA industry (%)", "2002 GVA services (%)", "2002 GVA public sector (%)"))
```

What we learn from these maps is that the sectoral structure varied strongly within Brazil. There also appeared to occur some spatial clustering: The agricultural sector was especially dominant along the Amazon frontier areas in the Central-West Region, while it was of minor importance in the metropolitan areas around São Paulo and Rio de Janeiro. There, it were the industry and service sectors that contributed most to the total GVA. The GVA in public sector map shows that, relative to the total economic activity, municipalities in the very west of Brazil as well as the Northeast Region had clearly higher public shares than elsewhere. 

#### Open issues:

During this exploration phase, where I tried to access and illustrate important municipality-level data, a number of issues arose: 

1. Mining operations data: Until now, all 299 observations regarding the locations of active mining projects reflect the *current* state. As it will become clearer shortly, the growth rate modelling would actually require data for the year 2002, the initial year of the observed growth period, in order to circumvent endogeneity issues and to assess a causal link between the establishment of mines and potential changes in economic growth. Unfortunately, no such information is easily available from the SNL data. However, I have already downloaded historical reports for a list of more than 500 Brazilian mines, from which it may be possible to manually compile additional variables on the opening and closure dates of mine sites. Such data could be extremely valuable for further empirical analyses, as it would help creating the setting of a natural experiment, where some municipalities are, at some point in time, treated (with a mine), while control regions remain unaffected by the mining industry.

2. Outliers: GDP data and growth rates show extreme outliers for some cases. Until now, I took the data as is, without any further validity checks. It will certainly be neccessary to investigate the reasons for growth rates up to 8400%. 
```{r dataissues, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
summary(dat_gdp$g_cap)
```
What is more, I noticed that growth rates are very sensitive to the selected growth period. So far, I motivated the 2002-2011 period with the fact that it marks a distinct decade of economic growth. Considering dynamics over time and actually having more data available than for the years 2002 and 2011 leads me to the next open issue, which is 

3. the option of a spatial panel setting. Such an implementation would require a lot more data wrangling and, of course, an adaption of the econometric framework that is discussed below, but theoretically this would be a feasible exercise.

4. Collecting further explanatory variables: Until now, I only accessed and explored easily available variables. There is no question that the final analysis will need more information such as on municipality-level employment rates and a proxy variable on human capital. However, collecting such data at the sub-national level is not always an easy undertaking.

## Spatial connectivity

Next, I explore (a) how spatial connectivity between Brazilian municipalities could be summarised and (b) whether the variables at hand exhibit spatial dependence. I employ functions in `spdep` in order to define neighbours and then test for global and local spatial autocorrelation.

### W

Spatial modelling often uses weights in order to impose a spatial structure on the data in a parsimonious way. Therefore, a spatial weights matrix, commonly denoted $W$, is constructed. It can be defined in various ways, not only by considering information on spatial proximity, but also upon trade or cultural connectivity indicators. Here, I try 3 matrices based on spatial proximity: a queen contiguity definition of sharing borders, a k-nearest neighbours specification, and a distance bound matrix that considers all municipalities within a certain distance being neighbours. Other definitions, such as considering decreasing functions of distance, appear less attractive for my modelling, because these would yield less parsimonious solutions compared to the definitions mentioned above, where a large number of relations would be given zero weight.

I start with a queen contiguity matrix (`spdep::poly2nb()`), where neighbourhood is defined by sharing borders:

```{r neighbourscheck, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
library(spdep)
nb_q <- spdep::poly2nb(base_mun, queen=TRUE)
summary(nb_q)
```

The summary of `nb_q` reveals that the average number of neighbours (adjacent polygons) is 5.9, 14 polygons have only one neighbour and the most connected municipality borders 23 neighbours. Two municipalities (1523 and 3497) are islands and hence, according to this definition, have no neighbours. Since they are only of minor importance and not related to any mining activities at all, I exclude them from the data.

```{r neighboursqomit, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
base_mun <- base_mun[-c(1523, 3496),]
nb_q <- spdep::poly2nb(base_mun, queen=TRUE)
```

We can now have a look how this neighbourhood definition translates into a map:

```{r neighboursq, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
plot(sf::st_geometry(base_mun), border="grey", lwd=0.5)
coords <- sf::st_centroid(sf::st_geometry(base_mun), of_largest_polygon=TRUE)
plot(nb_q, coords=st_coordinates(coords), add=TRUE, points=FALSE, lwd=0.2)
```

Brazilian municipalities vary extremely in size. While they are smaller the closer they are to the Atlantic Ocean, municipalities towards and within the Amazon are considerably larger. We see on the map that this fact results in a network of neighbours that is differently dense.

Next, I try a  $k = 5$ nearest neighbours definition using the `spdep::knearneigh()` function:

```{r neighboursn, echo = FALSE, eval = TRUE, message=FALSE,  warning=FALSE}
nb_5nnb <- spdep::knearneigh(coords, k=5)
nb_5nnb <- spdep::knn2nb(nb_5nnb, sym=F)
plot(sf::st_geometry(base_mun), border="grey", lwd=0.5)
plot(nb_5nnb, coords=st_coordinates(coords), add=TRUE, points=FALSE, lwd=0.2)
```

As all municipalities are forced to have exactly 5 neighbours (while the average number of neighbours was 6, with a maximum of 23, for the queen contiguity specification), this map appears less dense.  

As a last option, I compute a distance bound spatial weights matrix. I make sure that each municipality has at least 1 neighbour using `spdep::knearneigh(k=1)` first and extracting the maximum distance, followed by `spdep::dnearneigh()` using this maximum distance as the upper bound: 

```{r neighboursd, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
nb_1nnb <- spdep::knearneigh(coords, k=1)
nb_1nnb <- spdep::knn2nb(nb_1nnb, sym=F)
maxdist <- max(unlist(spdep::nbdists(nb_1nnb, coords=coords)))

nb_dist <- spdep::dnearneigh(coords, d1=0, d2=maxdist)
plot(sf::st_geometry(base_mun), border="grey", lwd=0.5)
plot(nb_dist, coords=st_coordinates(coords), add=TRUE, points=FALSE, lwd=0.2)
```

The map clearly indicates that the distance bound definition yields an undesirable result, because municipalities are so differently sized, while it is not yet clear which of the other two neighbourhood definitions would be preferable. In fact, this choice is not trivial. What I have seen from spatial analyses before is that researchers usually try to motivate the choice of their definition theoretically, or that they demonstrate that varying spatial weights matrices yield comparable results. Bayesian estimation approaches would, furthermore, allow for leaving the decision on $W$ to a certain extent up to an algorithm [@lesage2009introduction].

For the rest of this analysis, I will proceed with the $k = 5$ nearest neighbours weights matrix. Robustness checks, where I compare it to the queen contiguity definition and variations in $k$, are left to a later stage.

Since the dimensions of $W$, an $n \times n$ matrix for $n$ spatial observations must exactly fit to the $n \times k$ design matrix, I now make sure that `NA` entries of the variable of interest are excluded from the data and then compute a final weights matrix:

```{r dims, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
dat_gdp <- dat_gdp[!is.na(dat_gdp$pib_per_capita),]
dat_sect <- dat_sect %>% dplyr::filter(code_mn %in% dat_gdp$code_mn)
dat_pop <- dat_pop %>% dplyr::filter(code_mn %in% dat_gdp$code_mn)

coords <- sf::st_centroid(sf::st_geometry(dat_gdp), of_largest_polygon=TRUE)
nb_5nnb <- spdep::knearneigh(coords, k=5)
nb_5nnb <- spdep::knn2nb(nb_5nnb, sym=F)
```

### Spatial autocorrelation

We speak of *spatial autocorrelation*, if a systemic spatial pattern of a specific characteristic happens to occur, i.e. features are not randomly distributed across space. Positive spatial autocorrelation describes a situation where similar observations are closer to each other, and in the case of negative spatial autocorrelation close observations are more dissimilar than those locations further away. For real world spatial data, it is rare that the data shows complete spatial randomness. 

In a classical linear regression framework, we assume independence of observations, which is hence likely to be a violated assumption when using spatial data. Therefore, it is crucial to detect such spatial dependence and to apply methods that allow addressing this issue. 

Examining the maps above already allows for a first intuition about the presence of spatial clustering. However, this may not always be absolutely clear and we might want to test for and quantify the strength of spatial autocorrelation. The most common measure for global (i.e. providing a single value representing the data) spatial autocorellation is the Moran's I statistic. It essentially evaluates how similar observations at location $i$ deviate from the mean compared to neighbouring regions of that location $i$ compare to the mean. Formally, it is defined as

$$I = \frac{\sum_{i=1}^n\sum_{j=1}^n w_{i,j} (x_i-\bar{x}) (x_j-\bar{x})}{(\sum_{i=1}^n\sum_{j=1}^n w_{i,j}) \sum_{i=1}^n(x_i-\bar{x})^2}$$

where $x_i$ and $x_j$ are observations at locations $i$ and $j$, and $w_{i,j}$ is the weight that determines the relationship between $i$ and $j$. We can derive the expected value of $I$, which would correspond to a random distribution of observations,

$$E(I) = \frac{-1}{n-1}$$
, and test whether $I$ is significantly different from $E(I)$.

Using the neighbourhood definition from above, I now compute the Moran's I for my Brazilian data using `spdep::moran.test()`. Before that, I supplement the neighbours list with spatial weights (`spdep::nb2listw()`) applying row standardisation by setting `style="W"`.

```{r moransi, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
lwW <- spdep::nb2listw(nb_5nnb, style="W")

out <- dplyr::bind_rows(
  broom::tidy(spdep::moran.test(dat_gdp$pib_per_capita, listw=lwW, randomisation=FALSE, alternative="two.sided"))[1:5],
  broom::tidy(spdep::moran.test(dat_gdp$g_cap, listw=lwW, 
                                randomisation=FALSE, alternative="two.sided"))[1:5],
  broom::tidy(spdep::moran.test(dat_pop$g_pop, listw=lwW, 
                                randomisation=FALSE, alternative="two.sided"))[1:5],
  broom::tidy(spdep::moran.test(dat_sect$vab_agropecuaria_perc, listw=lwW, 
                                randomisation=FALSE, alternative="two.sided"))[1:5],
  broom::tidy(spdep::moran.test(dat_sect$vab_industria_perc, listw=lwW, 
                                randomisation=FALSE, alternative="two.sided"))[1:5],
  broom::tidy(spdep::moran.test(dat_sect$vab_servicos_exclusivo_perc, listw=lwW, 
                                randomisation=FALSE, alternative="two.sided"))[1:5],
  broom::tidy(spdep::moran.test(dat_sect$vab_adm_publica_perc, listw=lwW, 
                                randomisation=FALSE, alternative="two.sided"))[1:5])
names(out)[1:3] <- c("Moran's I", "Expectation", "Variance")
```

```{r moransinames, echo = FALSE, eval = TRUE, message=FALSE,  warning=FALSE}
out <- dplyr::bind_cols("Variable" = c("2002 GDP (per capita, BRL)", 
                                       "2002-2011 per cap. GDP growth (%)", 
                                       "2002-2011 population growth (%)", 
                                       "2002 GVA acgriculture (%)", "2002 GVA industry (%)", 
                                       "2002 GVA services (%)", "2002 GVA public sector (%)"), 
                        out)
out
```

All variables considered are found to exhibit significant positive spatial autocorrelation. I find weakest spatial dependence for GDP growth rates (0.12), and most considerable spatial autocorrelation for GVA in the public sector (0.73).

Another useful tool for investigating spatial autocorrelation is drawing Moran scatterplots [@anselin1996moran], where the variable of interest is plotted against its spatial lag (i.e. the average outcome for that variable across neighbouring regions): 

```{r moranplots, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE, fig.show="hold", out.width="50%"}
spdep::moran.plot(dat_gdp$pib_per_capita, listw=lwW)
spdep::moran.plot(dat_gdp$g_cap, listw=lwW)
```

Moran's I is a global statistic, and its strength is that is summarises the data by a single value. However, it does not give any insights which observations are similar or different to observations in their neighbourhood. Here, the Local Moran's I can help. Its nature is similar to the global statistic, but each observation receives its own $I$ statistic, as well as its own expected value and variance. Without going into detail here, it essentially evaluates how each observation deviates from the mean compared to how its neighbouring observations compare to the mean. The significance and direction of the Local Moran's I can then be nicely illustrated on a map:

```{r localmoran, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
localm_pib <- spdep::localmoran(dat_gdp$pib_per_capita, listw=lwW, alternative = "two.sided") %>% 
  dplyr::as_data_frame() 
colnames(localm_pib) <- c(colnames(localm_pib)[-5], "p_pib")
localm_pib <- sf::st_as_sf(localm_pib %>% 
                             dplyr::mutate(geometry = sf::st_geometry(dat_gdp)) %>%
                             dplyr::mutate(code_mn = dat_gdp$code_mn)) %>% 
  dplyr::mutate(lsa_pib = ifelse(Ii > 0, "positive", "negative"))

localm_g <- spdep::localmoran(dat_gdp$g_cap, listw=lwW, alternative = "two.sided") %>% 
  dplyr::as_data_frame() 
colnames(localm_g) <- c(colnames(localm_g)[-5], "p_g")
localm_g <- localm_g %>% dplyr::mutate(code_mn = dat_gdp$code_mn) %>%
  dplyr::mutate(lsa_g = ifelse(Ii > 0, "positive", "negative"))

localm <- dplyr::left_join(localm_pib, localm_g, by = "code_mn") %>%
  dplyr::mutate(lsa_pib = ifelse(p_pib < 0.05, lsa_pib, NA),
                lsa_g = ifelse(p_g < 0.05, lsa_g, NA)) 

tmap::tm_shape(base_nat) + tmap::tm_borders(lwd=2) +
tmap::tm_shape(localm) + 
  tmap::tm_facets(nrow = 1) + 
  tmap::tm_borders(lwd=0.1, alpha=0.4) +
  tmap::tm_fill(col = c("lsa_pib", "lsa_g"), style = "cat", palette = "Set1",
                title = "Local Moran's I",
                colorNA = "white", textNA = "not significant",) +
tmap::tm_layout(legend.position = c("left", "bottom"),
                  panel.labels=c("2002 GDP (per capita, BRL)", "2002-2011 growth rate (%)"))
```

What I find is that 2002 municipal GDP, for example, has large hotspots of positive spatial autocorrelation in the Central-West Region and, to a smaller extent, in the south and along the coast in the east. 2002-2011 economic growth rates show only few hotspots of positive spatial autocorrelation. For both variables, I hardly find any cases of significant negative spatial autocorrelation.

## Proposal of a municipality-level growth model

Typical growth regressions, as motivated in the literature on convergence across countries, regress growth rates of countries or regions on their capital stock (usually GDP) at the initial period as well as a number of further determinants of growth [@barro1991economic]. Typically, these include information such as on population growth, human capital stock, sectoral structure and employment [@crespo2014determinants]. These variables likely exhibit spatial dependence, implying that the assumption of independence between observations - typically assumed in classical linear regressions - is violated. In fact, I demonstrated in the sections above that the variables so-far collected for my research are spatially autocorellated. Spatial econometric models explicitly consider spatial dependence. @lesage2008growth propose following Spatial Durbin Model (SDM) for growth regressions:

$$\boldsymbol{y} = \rho \boldsymbol{Wy} + \boldsymbol{X\beta} + \boldsymbol{WX \theta} + \boldsymbol{u}$$
In my analysis, the dependent variable $\boldsymbol{y}$ denotes an $n \times 1$ vector of regional economic growth rates for $n$ Brazilian municipalities. $\boldsymbol{X}$ is an $n \times k$ matrix of $k$ exogenous regional characteristics in the initial period. $\mathbf{W}$ denotes the spatial weights or connectivity matrix, allowing for parsimonious treatment of spatial dependence [@anselin2013spatial]. It is an $n \times n$, non-negative, row-standardised matrix with $w_{ii} = 0$. Its elements are used to specify the spatial dependence structure among the observations, i.e. $w_{ij} > 0$ if region $j$ is in a neighbourhood relationship with region $i$ ($i, j = 1, \dots, n$). As illustrated above, I employ a $k = 5$ nearest neighbours specification for the definition of neighbourhood. The $k \times 1$ vectors $\boldsymbol{\beta}$ and $\boldsymbol{\theta}$ correspond to $\boldsymbol{X}$ and $\boldsymbol{WX}$ respectively, and $\rho \in (-1, 1)$ captures the strength of spatial autocorrelation. The random error term $\boldsymbol{u}$ is assumed to be constant and normally distributed.

Note that the SDM collapses into altered forms of spatial model types if either $\lambda = 0$ or $\rho = 0$. The former is referred to as the spatial autoregressive model (SAR). The latter type represents the so-called spatial lag of X model (SLX). For the case of both parameters being zero, the model collapses to a classical linear model.

For this report, I use 2002-2011 growth rates of Brazilian municipalities (in %) as the dependent variable. The set of explanatory variables consists of the municipalities' GDP in 2002 (current BRL, logged), 2002-2011 population growth (%), the GVA in agriculture and industry (%, share of total GVA), as well as a binary indicator whether or not there are mining operations ongoing in the respective municipality. As noted above, this indicator is unfortunately not yet representing the *initial* year of the analysed growth period - an issue that still has to be sorted out, but requires arduous manual work.

I first run a classical linear model without considering any kind of spatial dependence. Subsequently, I estimate SAR-, SLX- and SDM-type spatial models. Note that although originally intended to use artificial data for this report, I decided to start right away with real data for this still small and preliminary model.

### Classical linear model

Before I can run the basic linear model, I compile a `data.frame` including all relevant variables. In total, it covers 6 variables for 5548 municipalities.

```{r regdata, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
reg_data <- dplyr::left_join(
  dat_gdp %>% dplyr::select(code_mn, g_cap, pib_per_capita),
  dat_pop %>% dplyr::select(code_mn, g_pop) %>% sf::st_drop_geometry(), by = "code_mn") %>%
  dplyr::left_join(dat_sect %>% dplyr::select(code_mn, vab_agropecuaria_perc, vab_industria_perc) %>% 
                     sf::st_drop_geometry(), by = "code_mn")

reg_data <- reg_data %>% 
  dplyr::left_join(bra_mines %>% 
                     sf::st_drop_geometry() %>% 
                     dplyr::mutate(code_mn = as.character(code_mn)) %>%
                     dplyr::select(code_mn, mine_count), 
                   by = c("code_mn" = "code_mn")) %>% dplyr::select(-code_mn) %>%
  sf::st_drop_geometry() %>%
  dplyr::mutate(mine = ifelse(is.na(mine_count), 0, 1)) %>%
  dplyr::select(-mine_count)

dim(reg_data)
```

Now, I run the model:
```{r clm, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
m <- g_cap ~ log(pib_per_capita) + g_pop + mine + vab_agropecuaria_perc + vab_industria_perc
m_ols <- lm(formula = m, data = reg_data); summary(m_ols)
```

I find a negative effect of the initial capital stock, which is in accordance with the idea of convergence, i.e. poor regions experience higher growth rates. The mining indicator shows a strong positive influence of mining operations on economic growth. The third covariate that appears to have a significant (and positive) influence is GVA in the industry sector. To my surprise, population growth and - even though Brazil is a major exporter of biomass - GVA in agriculture yield insignificant estimates. Possible explanations why the relative size of the agricultural sector is of little importance may be first that I measure the effect of the sector's size in 2002 on 2002-2011 growth, while maybe largest dynamics in this sector only took place after 2002, and second it may as well be the case that the revenues from agriculture do not stay within the respective municipalities. 

Yet, these results must be viewed with caution. First, we can assume from the analysis before that the model is misspecified due to spatial dependence. Second, the model has a surprisingly low goodness of fit ($R^2 = 0.02$). It might very well be that important determinants of growth are omitted. While I will have to live with the latter problem for now, it is the issue of spatial dependence that I want to address in the further modelling.

I do not want the residuals of the model to have a spatial pattern. This can be tested using `spdep::lm.morantest()`:

```{r lmmorantest, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
spdep::lm.morantest(m_ols, listw=lwW, alternative="two.sided")
```

What I find is positive spatial autocorrelation in the residuals. Although this correlation seems not to be too high, this means that the residuals are systematically related. As this is a problem for statistical inference, I will now try to address this issue by the means of spatial econometrics.

### Spatial models

The `spatialreg` package supports a number of spatial regression models, three of which I am going to employ: SAR (the 'global spatial model', i.e. including a spatially lagged dependent variable), SLX (the 'local spatial model', where the explanatory variables are are extended by their spatial lag), and SDM (global and local spatial autocorrelation combined). 

First, I calculate the SAR model:
```{r sar, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
m_sar <- spatialreg::lagsarlm(formula = m, data = reg_data, listw = lwW); summary(m_sar)
```

Next, I run the SLX model:
```{r slx, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
m_slx <- spatialreg::lmSLX(formula = m, data = reg_data, listw = lwW); summary(m_slx)
```

Finally, I run the SDM model initially explained in this section and proposed by @lesage2008growth:
```{r sdm, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
m_sdm <- spatialreg::lagsarlm(formula = m, data = reg_data, listw = lwW, Durbin = TRUE) 
summary(m_sdm)
```

Comparing all four models, what I notice first is that there are no crucial differences such as switches of the directions or changes regarding the statistical significance of effects. When looking closer, it becomes, however, apparent that OLS overestimates the effect of the presence of a mine, because it does not take into consideration spatial spillovers. A similar behaviour is observed for GVA in industry. For the models that consider a spatially lagged dependent variable (SAR and SDM), I find a highly significant spatial autoregressive parameter of approximately 0.24. SLX and SDM further show that the spatial lags of initial GDP, the presence of mining, and GVA in industry have significantly positive effects. Another interesting finding, which would not emerge from a non-spatial model, is that besides convergence, i.e. a negative effect for initial capital, there is a positive coefficient for the spatial lag of initial capital. This means that initially rich municipalities grow slower, but also that there is a positive growth effect for regions that have richer municipalities as neighbours.

The first advantage of spatial modelling is of technical nature, i.e. it is a way of improving situations where model residuals are correlated. In the OLS model, I found such autocorrelation. Let's check, if this has improved:

```{r residualscheck, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
reg_data$res <- residuals(m_sar)
spdep::moran.mc(reg_data$res, lwW, 999)

reg_data$res <- residuals(m_slx)
spdep::moran.mc(reg_data$res, lwW, 999)

reg_data$res <- residuals(m_sdm)
spdep::moran.mc(reg_data$res, lwW, 999)
```

According to the tests, SAR and SDM manage to solve the issue of correlated residuals, while the SLX fails. I therefore conclude that I will need a global spatial model, i.e. one that considers spatially lagged growth rates. 

The second advantage is that spatial models may give interesting insights regarding the spatial transmission of effects. But first, a little bit more clarification is needed: While the tests above suggest that the spatial lag of $y$ is a useful addition, it makes the interpretation of the results somewhat more complicated. For SAR and SDM models, a change in a single observation in one region will affect the region itself (direct impact), but also all other regions indirectly via spillover effects arising from the spatially lagged dependent variable (indirect impact). This results in $n^2$ partial derivatives of a particular explanatory variable. @lesage2009introduction provide computational approaches to calculating summary measures for these impacts, i.e. average direct and average spillover (or indirect) effects. Average direct effects correspond to the average response of the dependent to independent variables over the sample of observations and hence may be understood in a way similar to the interpretation of typical regression coefficients. The average spillover effects correspond to the cumulative average response of a region’s dependent variable to a marginal change in an explanatory characteristic in all other regions. 

The impacts can be calculated using `spdep::impacts`:

```{r impacts, echo = TRUE, eval = TRUE, message=FALSE,  warning=FALSE}
spdep::impacts(m_sar, listw = lwW)
spdep::impacts(m_sdm, listw = lwW)
```

SAR and SDM yield comparable direct and indirect impact estimates. Regarding the variable of interest, presence of mining, I find a strong positive direct effect for both models, and a more moderate positive indirect in the SAR than in the SDM. The control variables behave very similarly, except for the initial capital variable, where the SAR is not able to detect the sign switch between direct and indirect effect.

Lastly, I want to contextualise these preliminary results briefly with regard to the research interest. From a first impression, it seems as if mining activities indeed positively related to GDP growth for the mining municipalities, and their neighbours. Yet, this is only one part of the story. While 2002-2011 was a general period of economic growth, it will be interesting to find out what happened to mining regions after the commodity boom. Did they develop differently from non-mining areas? Did they experience more severe recessions? Generally speaking, it would be interesting to look at a variety of growth horizons. Also, a panel setting could lead to further insights. In addition, I want to stress that, even if mines translate into economic growth rates, there are many other social and environmental aspects to be taken into consideration before jumping to the conclusion that mines are, in general, a good thing.

### Bayesian MCMC approaches for spatial econometric models

In this final section, I want to turn to a topic that I initially intended to cover also in an empirical sense in terms of writing code. Due to limited resources, I had to reduce this plan to a theoretical discussion. Nevertheless, it is a useful exercise for me to give an intuition about the idea of Bayesian spatial models:

@lesage2009introduction introduce the estimation of spatial models applying Bayesian methodology in their textbook. Central to this technique is to rely on *conditional distributions* involving data and estimated parameters in order to obtain the *posterior distributions* of single parameters. Instead of relying on a complicated analytical solution of these posterior distributions, they highlight the usefulness of Markov Chain Monte Carlo (MCMC) estimation approaches. The great benefit of approaching spatial econometric problems by the use of Bayesian estimation is that the MCMC sampling can be easily extended for specific model needs such as allowing for a heteroskedastic disturbance structure, model selection and model averaging, or modelling spatially autocorrelated cencored and binary dependent variables.

Let $D = \{y, X, W\}$ represent model data and $\theta$ denote the model parameters to be estimated. Applying Bayes rule, it follows that 

$$p(\theta|D) = \frac{p(D|\theta)p(\theta)}{p(D)}$$
The posterior distribution of $\theta$ thus is a compromise between *prior* information $p(\theta)$ and the *likelihood* $p(D|\theta)$, i.e. information coming from the sample data and the model. Simplifying this term by ignoring the data distribution $p(D)$ (it does not involve the parameters $\theta$), the posterior distribution of $\theta$ is a proportional product of $p(D|\theta)$ and $p(\theta)$. 

The likelihood of a SAR model, i.e. $y = (I-\rho W)^{-1} X\beta + u$, can be written as

$$p(D|\beta, \sigma, \rho) = (2\pi\sigma^2)^{-\frac{n}{2}} \ |A| \ exp\left(-\frac{1}{2\sigma^2}(Ay - X\beta)'(Ay - X\beta)\right)$$
where, for notation convenience, $A = I_n - \rho W$. This likelihood is then combined with prior distributions of the parameters in the model. @lesage2009introduction rely on a so-called *normal-inverse gamma prior* (NIG) for the parameters $\beta$ and $\sigma^2$, where $\beta$ follows a normal distribution conditional on an inverse gamma distribution for the parameter $\sigma^2$. While we have usually little intuition for $\beta$ and $\sigma^2$ and hence rely on fairly uninformative priors for these parameters, the case of $\rho$ is more interesting. From the row-standardisation of W and its corresponding eigenvalues, we know that $\rho \in (-1,1)$. Reasonable prior choices for $\rho$ would be a uniform distribution on the interval $(-1, 1)$ or, following @lesage2007beta, a $Beta(d, d)$ distribution that is centered on zero. Negative spatial dependence may further be of little interest for certain applications, motivating a prior where $\rho \in [0,1)$.

Instead of working out analytical/numerical integration solutions for this problem, the idea of MCMC sampling is to examine a large random sample from the posterior distribution. For $\beta$ and $\sigma^2$, @lesage2009introduction show that the conditional distributions under the NIG prior take known forms: $\beta$ comes from a multivariate normal with mean and variance obtained from combining data and prior information, and $\sigma^2$ follows an inverse gamma distribution with shape and scale parameters that are, again, computed from available information. As these are familiar conditional distriutions, it is possible to apply a sampling technique referred to as *Gibbs sampling*, where the respective parameters are sampled and updated treating the remaining parameters as known.

Yet, we do not always know the distributional form of conditional distributions, as is the case for the spatial parameter $\rho$. It takes the form
$$p(\rho|\beta, \sigma) \propto |I_n-\rho W| \ exp\left(-\frac{1}{2\sigma^2}(Ay - X\beta)'(Ay - X\beta)\right)$$
Therefore, we need an alternative sampling approach, such as the Metropolis-Hastings (M-H) algorithm. Meeting the notion of easily extendable, toolbox-style, Bayesian approaches, this procedure of sampling for $\rho$ is integrated as a separate step in the Gibbs sampling (*Metropolish within Gibbs*). The M-H sampling works as follows: In a first step, $\rho^*$, a candidate value for $\rho$, is generated from a *proposal distribution*. Second, this candidate value as well as the current value, which we label $\rho^c$, are used to evaluate the respective conditional likelihoods, in order to calculate an acceptance probability 
$$\psi_H(\rho^c, \rho^*) = min \left[ 1, \frac{p(\rho^*|\beta, \sigma)}{p(\rho^c|\beta, \sigma)} \right] $$
Finally, the proposed $\rho^*$ is accepted and becomes the new $\rho^c$ with probability $\psi_H(\rho^c, \rho^*)$ and otherwise we stay with the current value of $\rho^c$ for the next iteration. As a proposal distribution, @lesage2009introduction refer to a normal distribution along with a *tuned random walk procedure* suggested by @holloway2002bayesian, i.e. $\rho^* = \rho^c + c \cdot N(0,1)$, in order to let the sampler *move* over the entire conditional distribution. The *tuning* parameter $c$ is adjusted based on monitoring the acceptance rates, such as $c' = c/1.1$ whenever the acceptance rate falls below 40\% and $c' = c \cdot 1.1$ whenever it rises above 60\%. Moreover, we can make sure that $-1 < \rho < 1$ or any other restriction by using *rejection sampling*, i.e. rejecting values of $\rho$ outside the desired interval and drawing another proposal.

To provide a comprehensive overview, I here recall the MCMC sampling algorithm for the SAR model under the $NIG(c, T, a, b)$ prior for $\beta$ and $\sigma^2$ as summarised by @lesage2009introduction:

1. Sample $p(\beta|\sigma^2_{(0)}, \rho_{(0)})$ using the $N(c^*, \sigma_{(0)}T^*)$) distribution with mean and variance:
$$c^* = (X'X + T^{-1})^{-1}(X'(I_n - \rho_{(0)} W)y + T^{-1}c \\ T^* = (X'X + T^{-1})^{-1}$$
Label the sampled parameter vector $\beta_{(1)}$ and use this to replace the parameter vector $\beta_{(0)}$.
Note that we have to set the parameters $c$ and $T$ for the NIG prior. As we face high prior uncertainty, we can choose a rather uninformative prior by setting $c=0$ and $T = I_k \cdot 10^{10}$.

2. Sample $p(\sigma^2|\beta_{(1)}, \rho_{(0)})$, using an inverse gamma distribution $IG(a^*, b^*)$, where
$$a^* = a + n/2 \\ b^* = b + (Ay-X\beta_{(1)})'(Ay-X\beta_{(1)})/2 \\ A = I_n - \rho_{(0)} W$$
For a diffuse prior, we can assign $a = b = 0$.

3. Sample $p(\rho|\beta_{(1)}, \sigma_{(1)})$ using the M-H algorithm. Label this updated value $\rho_{(1)}$ and return to step 1.

This sequence of steps is repeated many times in order to obtain and - after some *burn-in period* - collect a large number of draws. These allow for inference regarding the model parameters other than by the use of mean and standard deviation point estimates as known from frequentist approaches. In fact, we can construct the entire posterior distribution of the parameters from which one can easily derive means, medians, or credible intervals.

What is next on my list is to code the sampling algorithms for the SAR, as well as for the SDM and SLX types of spatial models.

## References
